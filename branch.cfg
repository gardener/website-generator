cfgs:
  default:
    index: 0
    branches: ['master|rc|release-v.*']
    inherit:
      gardener-website-generator:
        template: 'default'
        base_definition:
          traits:
            component_descriptor: ~
            version: ~
            scheduling:
              suppress_parallel_execution: true
          repo:
            name: 'gardener_website_generator'
            trigger: true
          repos:
          - name: 'gardener_website'
            path: 'gardener/website'
            branch: 'master'
            cfg_name: 'github_com'
            trigger: false
          - name: 'gardener_documentation'
            path: 'gardener/documentation'
            branch: 'master'
            cfg_name: 'github_com'
            trigger: true
        jobs:
          head-update:
            steps:
              build:
                image: 'eu.gcr.io/gardener-project/gardener-website-generator:10.2.0'
                publish_to: ['gardener_website', 'gardener_documentation']
                vars:
                  BUILD: "'release'"     
                  RELEASES_COUNT: '3'
            traits:
              cronjob:
                interval: '24h'
          update-deps:
            traits:
              update_component_deps:
                merge_policy: auto_merge
              cronjob:
                interval: '15m'

  test_update:
    index: 1
    branches: ['test_update']
    inherit:
      gardener-website-generator:
        template: 'default'
        base_definition:
          traits:
            component_descriptor: ~
            version: ~
            scheduling:
             suppress_parallel_execution: true
          repo:
            name: 'gardener_website_generator'
            trigger: true
          repos:
          - name: 'gardener_website'
            path: 'gardener/website'
            branch: 'master'
            cfg_name: 'github_com'
            trigger: false
          - name: 'gardener_documentation'
            path: 'gardener/documentation'
            branch: 'test_update'
            cfg_name: 'github_com'
            trigger: true
        jobs:
          head-update:
            steps:
              build:
                image: 'eu.gcr.io/gardener-project/gardener-website-generator:10.2.0'
                publish_to: ['gardener_website', 'gardener_documentation']
                vars:
                  BUILD: "'head_update'"
                  BUILDSINGLEBRANCH: "'true'"
                  BRANCH: "'test_update'"
              trigger_release:
                depends: ['component_descriptor']
                inputs:
                  component_descriptor_dir: component_descriptor_dir
                vars:
                  RELEASE_JOB_NAME: 'pipeline.variant("documentation-release").job_name()'
          documentation-release:
            repo:
              name: 'gardener_website_generator'
              trigger: false
            repos:
            - name: 'gardener_documentation'
              path: 'gardener/documentation'
              branch: 'test_update'
              cfg_name: 'github_com'
              trigger: false
            - name: 'gardener_website'
              path: 'gardener/website'
              branch: 'master'
              cfg_name: 'github_com'
              trigger: false
            traits:
              release: ~
              version:
                preprocess: finalize
            steps:
              build:
                image: 'eu.gcr.io/gardener-project/gardener-website-generator:10.2.0'
                publish_to: ['gardener_website', 'gardener_documentation']
                vars:
                  BUILD: "'release'"
                  BRANCH: "'test_update'"
                  BUILDSINGLEBRANCH: "'true'"
          update-deps:
            traits:
              update_component_deps:
                merge_policy: auto_merge
              cronjob:
                interval: '15m'
